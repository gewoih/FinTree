# FinTree — Актуальный TODO

_Обновлено: 2026-02-17_

## Как читать этот файл

- `P0` — критично, влияет на корректность данных и базовые сценарии пользователя.
- `P1` — важно, влияет на качество и предсказуемость продукта.
- `P2` — улучшения UX/UI и расширения функциональности.

---

## P0 — Критичные задачи

### 1) Глобальная консистентность state на фронте (session/user leakage)

**Проблема:** после logout/login под другим пользователем фронт местами показывает состояние прошлого аккаунта до refresh.

**Цель:** полностью исключить «перетекание» данных между пользователями в рамках одного SPA-сеанса.

**План реализации:**

- [ ] Ввести `clearFinanceState()` и вызывать его при `logout`, при сбросе сессии и при смене `currentUser.id`.
- [ ] Убрать guard-логику вида «если массив не пустой — не грузить» для user-scoped данных.
- [ ] Перейти на `loaded flags` + привязку к `userId` (например, `loadedForUserId`).
- [ ] Защититься от гонок асинхронных ответов (игнор stale-ответов прошлой сессии).
- [ ] Добавить readiness-гейты в UI (онбординг/страницы не должны читать старые данные до завершения инициализации текущего пользователя).
- [ ] Зафиксировать регрессионные сценарии: `A -> logout -> B` без refresh на ключевых страницах.

**Важно (принцип):** создание транзакции не должно инициировать повторный забор данных из API; это должно управляться состояниями фронта.

---

### 2) Lifecycle онбординга

**Контекст:** первый вход и завершение обучения должны быть полностью детерминированы без ручного обновления страницы.

- [ ] В обучении отсутствует шаг/настройка категорий.
- [ ] Обучение не завершается корректно (не исчезает без refresh).
- [ ] В сайдбаре не отображается имя пользователя при входе через Telegram.
- [ ] Завершить консолидацию post-auth/onboarding flow до одного источника истины по состояниям.

---

## P1 — Важные продуктовые задачи

### Accounts (Счета)

**UI / UX**

- [ ] Скрывать фильтр, если счетов меньше 5.
- [ ] Убрать лишние заголовки для упрощения визуала.
- [ ] Полный редизайн модального окна добавления счета.

**Доменная логика**

- [ ] Пересмотреть концепцию начального остатка (заменить/дополнить корректировками).
- [ ] Первый созданный счет автоматически делать основным.
- [ ] Сделать механику «баланс vs корректировки» более очевидной.

**Консистентность состояния**

- [ ] Баланс не обновляется после добавления корректировки.

---

### Transactions (Транзакции)

- [ ] Валидировать дату транзакции относительно даты создания счета.
- [ ] Починить переходы в транзакции при кликах на пиковых днях и расходах по категориям.

---

### Analytics (Аналитика)

- [ ] Переименовать метрику «Баланс» на странице аналитики.
- [ ] Не показывать графики/метрики при недостаточном объеме данных (минимум 5-10 дней транзакций).
- [ ] Динамику расходов строить с даты первой транзакции.
- [ ] Изменение капитала не должно начинать расчет с несуществующих дат.

---

### Investments (Инвестиции)

- [ ] Пока нет инвестиционных счетов, скрывать вторичные блоки страницы.
- [ ] Исправить расчет общей доходности.
- [ ] Добавить архивирование инвестиционных счетов.

---

### Filters (Фильтры)

- [ ] Полный редизайн фильтров.
- [ ] Кнопка сброса фильтров работает не на всех страницах.

---

## P2 — Улучшения

### Calendar (Календарь)

- [ ] Русифицировать календарь.

---

### Categories (Категории)

- [ ] Пересобрать набор иконок категорий (убрать нерелевантные, добавить полезные).

---

### UI / Layout / Навигация

- [ ] Пересобрать лендинг (меньше текста, более читаемая композиция).
- [ ] В сайдбаре заменить стрелку на бургер-меню (или другой более понятный паттерн).

---

### Frontend Validation

- [ ] Добавить полноценные фронтенд-валидации пользовательского ввода.
